<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>8.5.7. Tutorial for Thermalized Drude oscillators in LAMMPS &mdash; LAMMPS documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/lammps.css" type="text/css" />
    <link rel="shortcut icon" href="_static/lammps.ico"/>
    <link rel="canonical" href="https://docs.lammps.org/Howto_drude2.html" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="_static/mathjax/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="8.5.8. Peridynamics with LAMMPS" href="Howto_peri.html" />
    <link rel="prev" title="8.5.6. Drude induced dipoles" href="Howto_drude.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="Manual.html">
            <img src="_static/lammps-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="lammps_version">Version: <b>8 Feb 2023</b></div>
              <div class="lammps_release">git info: 8Feb2023</div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Install.html">2. Install LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Build.html">3. Build LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Run_head.html">4. Run LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Commands.html">5. Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Packages.html">6. Optional packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="Speed.html">7. Accelerate performance</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Howto.html">8. Howto discussions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Howto.html#general-howto">8.1. General howto</a></li>
<li class="toctree-l2"><a class="reference internal" href="Howto.html#settings-howto">8.2. Settings howto</a></li>
<li class="toctree-l2"><a class="reference internal" href="Howto.html#analysis-howto">8.3. Analysis howto</a></li>
<li class="toctree-l2"><a class="reference internal" href="Howto.html#force-fields-howto">8.4. Force fields howto</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="Howto.html#packages-howto">8.5. Packages howto</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Howto_spherical.html">8.5.1. Finite-size spherical and aspherical particles</a></li>
<li class="toctree-l3"><a class="reference internal" href="Howto_granular.html">8.5.2. Granular models</a></li>
<li class="toctree-l3"><a class="reference internal" href="Howto_body.html">8.5.3. Body particles</a></li>
<li class="toctree-l3"><a class="reference internal" href="Howto_polarizable.html">8.5.4. Polarizable models</a></li>
<li class="toctree-l3"><a class="reference internal" href="Howto_coreshell.html">8.5.5. Adiabatic core/shell model</a></li>
<li class="toctree-l3"><a class="reference internal" href="Howto_drude.html">8.5.6. Drude induced dipoles</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">8.5.7. Tutorial for Thermalized Drude oscillators in LAMMPS</a></li>
<li class="toctree-l3"><a class="reference internal" href="Howto_peri.html">8.5.8. Peridynamics with LAMMPS</a></li>
<li class="toctree-l3"><a class="reference internal" href="Howto_manifold.html">8.5.9. Manifolds (surfaces)</a></li>
<li class="toctree-l3"><a class="reference internal" href="Howto_spins.html">8.5.10. Magnetic spins</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Howto.html#tutorials-howto">8.6. Tutorials howto</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Examples.html">9. Example scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tools.html">10. Auxiliary tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="Errors.html">11. Errors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Programmer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Library.html">1. LAMMPS Library Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="Python_head.html">2. Use Python with LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Modify.html">3. Modifying &amp; extending LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Developer.html">4. Information for Developers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Command Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="commands_list.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="fixes.html">Fixes</a></li>
<li class="toctree-l1"><a class="reference internal" href="computes.html">Computes</a></li>
<li class="toctree-l1"><a class="reference internal" href="pairs.html">Pair Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="bonds.html">Bond Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="angles.html">Angle Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="dihedrals.html">Dihedral Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="impropers.html">Improper Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="dumps.html">Dump Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="fix_modify_atc_commands.html">fix_modify AtC commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Bibliography.html">Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="Manual.html">LAMMPS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="Manual.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="Howto.html"><span class="section-number">8. </span>Howto discussions</a></li>
      <li class="breadcrumb-item active"><span class="section-number">8.5.7. </span>Tutorial for Thermalized Drude oscillators in LAMMPS</li>
      <li class="wy-breadcrumbs-aside">
          <a href="https://www.lammps.org"><img src="_static/lammps-logo.png" width="64" height="16" alt="LAMMPS Homepage"></a> | <a href="Commands_all.html">Commands</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="Howto_drude.html" class="btn btn-neutral float-left" title="8.5.6. Drude induced dipoles" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Howto_peri.html" class="btn btn-neutral float-right" title="8.5.8. Peridynamics with LAMMPS" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p><span class="math notranslate nohighlight">\(\renewcommand{\AA}{\text{Å}}\)</span></p>
<section id="tutorial-for-thermalized-drude-oscillators-in-lammps">
<h1><span class="section-number">8.5.7. </span>Tutorial for Thermalized Drude oscillators in LAMMPS<a class="headerlink" href="#tutorial-for-thermalized-drude-oscillators-in-lammps" title="Permalink to this heading">¶</a></h1>
<p>This tutorial explains how to use Drude oscillators in LAMMPS to
simulate polarizable systems using the DRUDE package. As an
illustration, the input files for a simulation of 250 phenol molecules
are documented. First of all, LAMMPS has to be compiled with the
DRUDE package activated. Then, the data file and input scripts
have to be modified to include the Drude dipoles and how to handle
them.</p>
<p>Example input scripts available: examples/PACKAGES/drude</p>
<hr class="docutils" />
<p><strong>Overview of Drude induced dipoles</strong></p>
<p>Polarizable atoms acquire an induced electric dipole moment under the
action of an external electric field, for example the electric field
created by the surrounding particles.  Drude oscillators represent
these dipoles by two fixed charges: the core (DC) and the Drude
particle (DP) bound by a harmonic potential. The Drude particle can be
thought of as the electron cloud whose center can be displaced from
the position of the corresponding nucleus.</p>
<p>The sum of the masses of a core-Drude pair should be the mass of the
initial (unsplit) atom, <span class="math notranslate nohighlight">\(m_C + m_D = m\)</span>.  The sum of their charges
should be the charge of the initial (unsplit) atom, <span class="math notranslate nohighlight">\(q_C + q_D = q\)</span>.
A harmonic potential between the core and Drude partners should be
present, with force constant <span class="math notranslate nohighlight">\(k_D\)</span> and an equilibrium distance of
zero. The (half-)stiffness of the <a class="reference internal" href="bond_harmonic.html"><span class="doc">harmonic bond</span></a>
<span class="math notranslate nohighlight">\(K_D = k_D/2\)</span> and the Drude charge <span class="math notranslate nohighlight">\(q_D\)</span> are related to the atom
polarizability <span class="math notranslate nohighlight">\(\alpha\)</span> by</p>
<div class="math notranslate nohighlight">
\[K_D = \frac 1 2\, \frac {q_D^2} \alpha\]</div>
<p>Ideally, the mass of the Drude particle should be small, and the
stiffness of the harmonic bond should be large, so that the Drude
particle remains close to the core. The values of Drude mass, Drude
charge, and force constant can be chosen following different
strategies, as in the following examples of polarizable force
fields:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#lamoureux2"><span class="std std-ref">Lamoureux and Roux</span></a> suggest adopting a global half-stiffness, <span class="math notranslate nohighlight">\(K_D\)</span> = 500 kcal/(mol Ang <span class="math notranslate nohighlight">\({}^2\)</span>) - which corresponds to a force constant <span class="math notranslate nohighlight">\(k_D\)</span> = 4184 kJ/(mol Ang <span class="math notranslate nohighlight">\({}^2\)</span>) - for all types of core-Drude bond, a global mass <span class="math notranslate nohighlight">\(m_D\)</span> = 0.4 g/mol (or u) for all types of Drude particles, and to calculate the Drude charges for individual atom types from the atom polarizabilities using equation (1). This choice is followed in the polarizable CHARMM force field.</p></li>
<li><p>Alternately <a class="reference internal" href="#schroeder"><span class="std std-ref">Schroeder and Steinhauser</span></a> suggest adopting a global charge <span class="math notranslate nohighlight">\(q_D\)</span> = -1.0e and a global mass <span class="math notranslate nohighlight">\(m_D\)</span> = 0.1 g/mol (or u) for all Drude particles, and to calculate the force constant for each type of core-Drude bond from equation (1). The timesteps used by these authors are between 0.5 and 2 fs, with the degrees of freedom of the Drude oscillators kept cold at 1 K.</p></li>
<li><p>In both these force fields hydrogen atoms are treated as non-polarizable.</p></li>
</ul>
<p>The motion of of the Drude particles can be calculated by minimizing
the energy of the induced dipoles at each timestep, by an iterative,
self-consistent procedure. The Drude particles can be massless and
therefore do not contribute to the kinetic energy. However, the
relaxed method is computational slow. An extended-lagrangian method
can be used to calculate the positions of the Drude particles, but
this requires them to have mass. It is important in this case to
decouple the degrees of freedom associated with the Drude oscillators
from those of the normal atoms. Thermalizing the Drude dipoles at
temperatures comparable to the rest of the simulation leads to several
problems (kinetic energy transfer, very short timestep, etc.), which
can be remedied by the “cold Drude” technique (<a class="reference internal" href="#lamoureux2"><span class="std std-ref">Lamoureux and Roux</span></a>).</p>
<p>Two closely related models are used to represent polarization through
“charges on a spring”: the core-shell model and the Drude
model. Although the basic idea is the same, the core-shell model is
normally used for ionic/crystalline materials, whereas the Drude model
is normally used for molecular systems and fluid states. In ionic
crystals the symmetry around each ion and the distance between them
are such that the core-shell model is sufficiently stable. But to be
applicable to molecular/covalent systems the Drude model includes two
important features:</p>
<ol class="arabic simple">
<li><p>The possibility to thermostat the additional degrees of freedom associated with the induced dipoles at very low temperature, in terms of the reduced coordinates of the Drude particles with respect to their cores. This makes the trajectory close to that of relaxed induced dipoles.</p></li>
<li><p>The Drude dipoles on covalently bonded atoms interact too strongly due to the short distances, so an atom may capture the Drude particle (shell) of a neighbor, or the induced dipoles within the same molecule may align too much.  To avoid this, damping at short of the interactions between the point charges composing the induced dipole can be done by <a class="reference internal" href="#thole2"><span class="std std-ref">Thole</span></a> functions.</p></li>
</ol>
<hr class="docutils" />
<p><strong>Preparation of the data file</strong></p>
<p>The data file is similar to a standard LAMMPS data file for
<em>atom_style full</em>.  The DPs and the <em>harmonic bonds</em> connecting them
to their DC should appear in the data file as normal atoms and bonds.</p>
<p>You can use the <em>polarizer</em> tool (Python script distributed with the
DRUDE package) to convert a non-polarizable data file (here
<em>data.102494.lmp</em>) to a polarizable data file (<em>data-p.lmp</em>)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>polarizer<span class="w"> </span>-q<span class="w"> </span>-f<span class="w"> </span>phenol.dff<span class="w"> </span>data.102494.lmp<span class="w"> </span>data-p.lmp
</pre></div>
</div>
<p>This will automatically insert the new atoms and bonds.
The masses and charges of DCs and DPs are computed
from <em>phenol.dff</em>, as well as the DC-DP bond constants.  The file
<em>phenol.dff</em> contains the polarizabilities of the atom types
and the mass of the Drude particles, for instance:</p>
<pre class="literal-block"># units: kJ/mol, A, deg
# kforce is in the form k/2 r_D^2
# type  m_D/u   q_D/e    k_D   alpha/A3  thole
OH      0.4    -1.0    4184.0   0.63     0.67
CA      0.4    -1.0    4184.0   1.36     2.51
CAI     0.4    -1.0    4184.0   1.09     2.51</pre>
<p>The hydrogen atoms are absent from this file, so they will be treated
as non-polarizable atoms.  In the non-polarizable data file
<em>data.102494.lmp</em>, atom names corresponding to the atom type numbers
have to be specified as comments at the end of lines of the <em>Masses</em>
section.  You probably need to edit it to add these names. It should
look like</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Masses

1 12.011 # CAI
2 12.011 # CA
3 15.999 # OH
4 1.008  # HA
5 1.008  # HO
</pre></div>
</div>
<hr class="docutils" />
<p><strong>Basic input file</strong></p>
<p>The atom style should be set to (or derive from) <em>full</em>, so that you
can define atomic charges and molecular bonds, angles, dihedrals…</p>
<p>The <em>polarizer</em> tool also outputs certain lines related to the input
script (the use of these lines will be explained below).  In order for
LAMMPS to recognize that you are using Drude oscillators, you should
use the fix <em>drude</em>. The command is</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">fix </span><span class="nv nv-Identifier">DRUDE</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">drude</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="n">D</span>
</pre></div>
</div>
<p>The N, C, D following the <em>drude</em> keyword have the following meaning:
There is one tag for each atom type. This tag is C for DCs, D for DPs
and N for non-polarizable atoms.  Here the atom types 1 to 3 (C and O
atoms) are DC, atom types 4 and 5 (H atoms) are non-polarizable and
the atom types 6 to 8 are the newly created DPs.</p>
<p>By recognizing the fix <em>drude</em>, LAMMPS will find and store matching
DC-DP pairs and will treat DP as equivalent to their DC in the
<em>special bonds</em> relations.  It may be necessary to extend the space
for storing such special relations.  In this case extra space should
be reserved by using the <em>extra/special/per/atom</em> keyword of either
the <a class="reference internal" href="read_data.html"><span class="doc">read_data</span></a> or <a class="reference internal" href="create_box.html"><span class="doc">create_box</span></a>
command.  With our phenol, there is 1 more special neighbor for which
space is required.  Otherwise LAMMPS crashes and gives the required
value.</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">read_data</span><span class="w"> </span><span class="n">data</span><span class="o">-</span><span class="n">p.lmp</span><span class="w"> </span><span class="n">extra</span><span class="o">/</span><span class="n">special</span><span class="o">/</span><span class="n">per</span><span class="o">/</span><span class="n">atom</span><span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
<p>Let us assume we want to run a simple NVT simulation at 300 K.  Note
that Drude oscillators need to be thermalized at a low temperature in
order to approximate a self-consistent field (SCF), therefore it is not
possible to simulate an NVE ensemble with this package.  Since dipoles
are approximated by a charged DC-DP pair, the <em>pair_style</em> must
include Coulomb interactions, for instance <em>lj/cut/coul/long</em> with
<em>kspace_style pppm</em>. For example, with a cutoff of 10. and a precision
1.e-4:</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">pair_style</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">coul</span><span class="o">/</span><span class="n">long</span><span class="w"> </span><span class="m">10.0</span>
<span class="k">kspace_style</span><span class="w"> </span><span class="n">pppm</span><span class="w"> </span><span class="m">1.0e-4</span>
</pre></div>
</div>
<p>As compared to the non-polarizable input file, <em>pair_coeff</em> lines need
to be added for the DPs.  Since the DPs have no Lennard-Jones
interactions, their <span class="math notranslate nohighlight">\(\epsilon\)</span> is 0. so the only <em>pair_coeff</em> line
that needs to be added is</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">pair_coeff</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">6</span><span class="o">*</span><span class="w"> </span><span class="m">0.0</span><span class="w"> </span><span class="m">0.0</span><span class="w"> </span><span class="c"># All-DPs</span>
</pre></div>
</div>
<p>Now for the thermalization, the simplest choice is to use the <a class="reference internal" href="fix_langevin_drude.html"><span class="doc">fix langevin/drude</span></a>.</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">fix </span><span class="nv nv-Identifier">LANG</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">langevin</span><span class="o">/</span><span class="n">drude</span><span class="w"> </span><span class="m">300</span><span class="n">.</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">12435</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">13977</span>
</pre></div>
</div>
<p>This applies a Langevin thermostat at temperature 300. to the centers
of mass of the DC-DP pairs, with relaxation time 100 and with random
seed 12345.  This fix applies also a Langevin thermostat at temperature
1. to the relative motion of the DPs around their DCs, with relaxation
time 20 and random seed 13977.  Only the DCs and non-polarizable
atoms need to be in this fix’s group.  LAMMPS will thermostat the DPs
together with their DC.  For this, ghost atoms need to know their
velocities. Thus you need to add the following command:</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">comm_modify</span><span class="w"> </span><span class="n">vel</span><span class="w"> </span><span class="n">yes</span>
</pre></div>
</div>
<p>In order to avoid that the center of mass of the whole system
drifts due to the random forces of the Langevin thermostat on DCs, you
can add the <em>zero yes</em> option at the end of the fix line.</p>
<p>If the fix <em>shake</em> is used to constrain the C-H bonds, it should be
invoked after the fix <em>langevin/drude</em> for more accuracy.</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">fix </span><span class="nv nv-Identifier">SHAKE</span><span class="w"> </span><span class="nv nv-Identifier">ATOMS</span><span class="w"> </span><span class="n">shake</span><span class="w"> </span><span class="m">0.0001</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The group of the fix <em>shake</em> must not include the DPs.  If the
group <em>ATOMS</em> is defined by non-DPs atom types, you could use</p>
</div>
<p>Since the fix <em>langevin/drude</em> does not perform time integration (just
modification of forces but no position/velocity updates), the fix
<em>nve</em> should be used in conjunction.</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">fix </span><span class="nv nv-Identifier">NVE</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">nve</span>
</pre></div>
</div>
<p>To avoid the flying ice cube artifact, where the atoms progressively freeze and the
center of mass of the whole system drifts faster and faster, the <em>fix momentum</em>
can be used. For instance:</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">fix </span><span class="nv nv-Identifier">MOMENTUM</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">momentum</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="n">linear</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
<p>Finally, do not forget to update the atom type elements if you use
them in a <em>dump_modify … element …</em> command, by adding the element
type of the DPs. Here for instance</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">dump </span><span class="nv nv-Identifier">DUMP</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="n">dump.lammpstrj</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="n">mol</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="n">ix</span><span class="w"> </span><span class="n">iy</span><span class="w"> </span><span class="n">iz</span>
<span class="k">dump_modify</span><span class="w"> </span><span class="n">DUMP</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="n">O</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="n">D</span>
</pre></div>
</div>
<p>The input file should now be ready for use!</p>
<p>You will notice that the global temperature <em>thermo_temp</em> computed by
LAMMPS is not 300. K as wanted.  This is because LAMMPS treats DPs as
standard atoms in his default compute.  If you want to output the
temperatures of the DC-DP pair centers of mass and of the DPs relative
to their DCs, you should use the <a class="reference internal" href="compute_temp_drude.html"><span class="doc">compute temp_drude</span></a></p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">compute </span><span class="nv nv-Identifier">TDRUDE</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">temp</span><span class="o">/</span><span class="n">drude</span>
</pre></div>
</div>
<p>And then output the correct temperatures of the Drude oscillators
using <em>thermo_style custom</em> with respectively <em>c_TDRUDE[1]</em> and
<em>c_TDRUDE[2]</em>. These should be close to 300.0 and 1.0 on average.</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">thermo_style</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="n">c_TDRUDE[1]</span><span class="w"> </span><span class="n">c_TDRUDE[2]</span>
</pre></div>
</div>
<hr class="docutils" />
<p><strong>Thole screening</strong></p>
<p>Dipolar interactions represented by point charges on springs may not
be stable, for example if the atomic polarizability is too high for
instance, a DP can escape from its DC and be captured by another DC,
which makes the force and energy diverge and the simulation
crash. Even without reaching this extreme case, the correlation
between nearby dipoles on the same molecule may be exaggerated.  Often,
special bond relations prevent bonded neighboring atoms to see the
charge of each other’s DP, so that the problem does not always appear.
It is possible to use screened dipole-dipole interactions by using the
<a class="reference internal" href="pair_thole.html"><span class="doc">*pair_style thole*</span></a>.  This is implemented as a
correction to the Coulomb pair_styles, which dampens at short distance
the interactions between the charges representing the induced dipoles.
It is to be used as <em>hybrid/overlay</em> with any standard <em>coul</em> pair
style.  In our example, we would use</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">pair_style</span><span class="w"> </span><span class="n">hybrid</span><span class="o">/</span><span class="n">overlay</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">coul</span><span class="o">/</span><span class="n">long</span><span class="w"> </span><span class="m">10.0</span><span class="w"> </span><span class="n">thole</span><span class="w"> </span><span class="m">2.6</span><span class="w"> </span><span class="m">10.0</span>
</pre></div>
</div>
<p>This tells LAMMPS that we are using two pair_styles.  The first one is
as above (<em>lj/cut/coul/long 10.0</em>).  The second one is a <em>thole</em>
pair_style with default screening factor 2.6 (<a class="reference internal" href="#noskov2"><span class="std std-ref">Noskov</span></a>) and
cutoff 10.0.</p>
<p>Since <em>hybrid/overlay</em> does not support mixing rules, the interaction
coefficients of all the pairs of atom types with i &lt; j should be
explicitly defined.  The output of the <em>polarizer</em> script can be used
to complete the <em>pair_coeff</em> section of the input file.  In our
example, this will look like:</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">pair_coeff</span><span class="w">    </span><span class="m">1</span><span class="w">    </span><span class="m">1</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">coul</span><span class="o">/</span><span class="n">long</span><span class="w">    </span><span class="m">0.0700</span><span class="w">   </span><span class="m">3.550</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">1</span><span class="w">    </span><span class="m">2</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">coul</span><span class="o">/</span><span class="n">long</span><span class="w">    </span><span class="m">0.0700</span><span class="w">   </span><span class="m">3.550</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">1</span><span class="w">    </span><span class="m">3</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">coul</span><span class="o">/</span><span class="n">long</span><span class="w">    </span><span class="m">0.1091</span><span class="w">   </span><span class="m">3.310</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">1</span><span class="w">    </span><span class="m">4</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">coul</span><span class="o">/</span><span class="n">long</span><span class="w">    </span><span class="m">0.0458</span><span class="w">   </span><span class="m">2.985</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">2</span><span class="w">    </span><span class="m">2</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">coul</span><span class="o">/</span><span class="n">long</span><span class="w">    </span><span class="m">0.0700</span><span class="w">   </span><span class="m">3.550</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">2</span><span class="w">    </span><span class="m">3</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">coul</span><span class="o">/</span><span class="n">long</span><span class="w">    </span><span class="m">0.1091</span><span class="w">   </span><span class="m">3.310</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">2</span><span class="w">    </span><span class="m">4</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">coul</span><span class="o">/</span><span class="n">long</span><span class="w">    </span><span class="m">0.0458</span><span class="w">   </span><span class="m">2.985</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">3</span><span class="w">    </span><span class="m">3</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">coul</span><span class="o">/</span><span class="n">long</span><span class="w">    </span><span class="m">0.1700</span><span class="w">   </span><span class="m">3.070</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">3</span><span class="w">    </span><span class="m">4</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">coul</span><span class="o">/</span><span class="n">long</span><span class="w">    </span><span class="m">0.0714</span><span class="w">   </span><span class="m">2.745</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">4</span><span class="w">    </span><span class="m">4</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">coul</span><span class="o">/</span><span class="n">long</span><span class="w">    </span><span class="m">0.0300</span><span class="w">   </span><span class="m">2.420</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="o">*</span><span class="w">    </span><span class="m">5</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">coul</span><span class="o">/</span><span class="n">long</span><span class="w">    </span><span class="m">0.0000</span><span class="w">   </span><span class="m">0.000</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="o">*</span><span class="w">   </span><span class="m">6</span><span class="o">*</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">coul</span><span class="o">/</span><span class="n">long</span><span class="w">    </span><span class="m">0.0000</span><span class="w">   </span><span class="m">0.000</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">1</span><span class="w">    </span><span class="m">1</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">1.090</span><span class="w">   </span><span class="m">2.510</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">1</span><span class="w">    </span><span class="m">2</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">1.218</span><span class="w">   </span><span class="m">2.510</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">1</span><span class="w">    </span><span class="m">3</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">0.829</span><span class="w">   </span><span class="m">1.590</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">1</span><span class="w">    </span><span class="m">6</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">1.090</span><span class="w">   </span><span class="m">2.510</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">1</span><span class="w">    </span><span class="m">7</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">1.218</span><span class="w">   </span><span class="m">2.510</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">1</span><span class="w">    </span><span class="m">8</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">0.829</span><span class="w">   </span><span class="m">1.590</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">2</span><span class="w">    </span><span class="m">2</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">1.360</span><span class="w">   </span><span class="m">2.510</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">2</span><span class="w">    </span><span class="m">3</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">0.926</span><span class="w">   </span><span class="m">1.590</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">2</span><span class="w">    </span><span class="m">6</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">1.218</span><span class="w">   </span><span class="m">2.510</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">2</span><span class="w">    </span><span class="m">7</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">1.360</span><span class="w">   </span><span class="m">2.510</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">2</span><span class="w">    </span><span class="m">8</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">0.926</span><span class="w">   </span><span class="m">1.590</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">3</span><span class="w">    </span><span class="m">3</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">0.630</span><span class="w">   </span><span class="m">0.670</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">3</span><span class="w">    </span><span class="m">6</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">0.829</span><span class="w">   </span><span class="m">1.590</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">3</span><span class="w">    </span><span class="m">7</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">0.926</span><span class="w">   </span><span class="m">1.590</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">3</span><span class="w">    </span><span class="m">8</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">0.630</span><span class="w">   </span><span class="m">0.670</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">6</span><span class="w">    </span><span class="m">6</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">1.090</span><span class="w">   </span><span class="m">2.510</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">6</span><span class="w">    </span><span class="m">7</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">1.218</span><span class="w">   </span><span class="m">2.510</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">6</span><span class="w">    </span><span class="m">8</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">0.829</span><span class="w">   </span><span class="m">1.590</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">7</span><span class="w">    </span><span class="m">7</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">1.360</span><span class="w">   </span><span class="m">2.510</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">7</span><span class="w">    </span><span class="m">8</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">0.926</span><span class="w">   </span><span class="m">1.590</span>
<span class="k">pair_coeff</span><span class="w">    </span><span class="m">8</span><span class="w">    </span><span class="m">8</span><span class="w"> </span><span class="n">thole</span><span class="w">   </span><span class="m">0.630</span><span class="w">   </span><span class="m">0.670</span>
</pre></div>
</div>
<p>For the <em>thole</em> pair style the coefficients are</p>
<ol class="arabic simple">
<li><p>the atom polarizability in units of cubic length</p></li>
<li><p>the screening factor of the Thole function (optional, default value
specified by the pair_style command)</p></li>
<li><p>the cutoff (optional, default value defined by the pair_style command)</p></li>
</ol>
<p>The special neighbors have charge-charge and charge-dipole
interactions screened by the <em>coul</em> factors of the <em>special_bonds</em>
command (0.0, 0.0, and 0.5 in the example above).  Without using the
pair_style <em>thole</em>, dipole-dipole interactions are screened by the
same factor.  By using the pair_style <em>thole</em>, dipole-dipole
interactions are screened by Thole’s function, whatever their special
relationship (except within each DC-DP pair of course).  Consider for
example 1-2 neighbors: using the pair_style <em>thole</em>, their dipoles
will see each other (despite the <em>coul</em> factor being 0.) and the
interactions between these dipoles will be damped by Thole’s function.</p>
<hr class="docutils" />
<p><strong>Thermostats and barostats</strong></p>
<p>Using a Nose-Hoover barostat with the <em>langevin/drude</em> thermostat is
straightforward using fix <em>nph</em> instead of <em>nve</em>.  For example:</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">fix </span><span class="nv nv-Identifier">NPH</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">nph</span><span class="w"> </span><span class="n">iso</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">500</span>
</pre></div>
</div>
<p>It is also possible to use a Nose-Hoover instead of a Langevin
thermostat.  This requires to use <a class="reference internal" href="fix_drude_transform.html"><span class="doc">*fix drude/transform*</span></a> just before and after the
time integration fixes.  The <em>fix drude/transform/direct</em> converts the
atomic masses, positions, velocities and forces into a reduced
representation, where the DCs transform into the centers of mass of
the DC-DP pairs and the DPs transform into their relative position
with respect to their DC. The <em>fix drude/transform/inverse</em> performs
the reverse transformation.  For a NVT simulation, with the DCs and
atoms at 300 K and the DPs at 1 K relative to their DC one would use</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">fix </span><span class="nv nv-Identifier">DIRECT</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">drude</span><span class="o">/</span><span class="n">transform</span><span class="o">/</span><span class="n">direct</span>
<span class="k">fix </span><span class="nv nv-Identifier">NVT1</span><span class="w"> </span><span class="nv nv-Identifier">ATOMS</span><span class="w"> </span><span class="n">nvt</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="m">300</span><span class="n">.</span><span class="w"> </span><span class="m">300</span><span class="n">.</span><span class="w"> </span><span class="m">100</span>
<span class="k">fix </span><span class="nv nv-Identifier">NVT2</span><span class="w"> </span><span class="nv nv-Identifier">DRUDES</span><span class="w"> </span><span class="n">nvt</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">20</span>
<span class="k">fix </span><span class="nv nv-Identifier">INVERSE</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">drude</span><span class="o">/</span><span class="n">transform</span><span class="o">/</span><span class="n">inverse</span>
</pre></div>
</div>
<p>For our phenol example, the groups would be defined as</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">group </span><span class="nv nv-Identifier">ATOMS</span><span class="w">  </span><span class="n">type</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c"># DCs and non-polarizable atoms</span>
<span class="k">group </span><span class="nv nv-Identifier">CORES</span><span class="w">  </span><span class="n">type</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w">     </span><span class="c"># DCs</span>
<span class="k">group </span><span class="nv nv-Identifier">DRUDES</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w">     </span><span class="c"># DPs</span>
</pre></div>
</div>
<p>Note that with the fixes <em>drude/transform</em>, it is not required to
specify <em>comm_modify vel yes</em> because the fixes do it anyway (several
times and for the forces also).</p>
<p>It is a bit more tricky to run a NPT simulation with Nose-Hoover
barostat and thermostat.  First, the volume should be integrated only
once. So the fix for DCs and atoms should be <em>npt</em> while the fix for
DPs should be <em>nvt</em> (or vice versa).  Second, the <em>fix npt</em> computes a
global pressure and thus a global temperature whatever the fix group.
We do want the pressure to correspond to the whole system, but we want
the temperature to correspond to the fix group only.  We must then use
the <em>fix_modify</em> command for this.  In the end, the block of
instructions for thermostatting and barostatting will look like</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">compute </span><span class="nv nv-Identifier">TATOMS</span><span class="w"> </span><span class="nv nv-Identifier">ATOMS</span><span class="w"> </span><span class="n">temp</span>
<span class="k">fix </span><span class="nv nv-Identifier">DIRECT</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">drude</span><span class="o">/</span><span class="n">transform</span><span class="o">/</span><span class="n">direct</span>
<span class="k">fix </span><span class="nv nv-Identifier">NPT</span><span class="w"> </span><span class="nv nv-Identifier">ATOMS</span><span class="w"> </span><span class="n">npt</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="m">300</span><span class="n">.</span><span class="w"> </span><span class="m">300</span><span class="n">.</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="n">iso</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">500</span>
<span class="k">fix_modify</span><span class="w"> </span><span class="n">NPT</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="n">TATOMS</span><span class="w"> </span><span class="n">press</span><span class="w"> </span><span class="n">thermo_press</span>
<span class="k">fix </span><span class="nv nv-Identifier">NVT</span><span class="w"> </span><span class="nv nv-Identifier">DRUDES</span><span class="w"> </span><span class="n">nvt</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">20</span>
<span class="k">fix </span><span class="nv nv-Identifier">INVERSE</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">drude</span><span class="o">/</span><span class="n">transform</span><span class="o">/</span><span class="n">inverse</span>
</pre></div>
</div>
<p>Another option for thermalizing the Drude model is to use the
temperature-grouped Nose-Hoover (TGNH) thermostat proposed by <a class="reference internal" href="fix_tgnh_drude.html#tgnh-son"><span class="std std-ref">(Son)</span></a>.
This is implemented as <a class="reference internal" href="fix_tgnh_drude.html"><span class="doc">fix tgnvt/drude</span></a> and <a class="reference internal" href="fix_tgnh_drude.html"><span class="doc">fix tgnpt/drude</span></a>.
It separates the kinetic energy into three contributions:
the molecular center of mass (COM) motion, the motion of atoms or atom-Drude pairs relative to molecular COMs,
and the relative motion of atom-Drude pairs.
An independent Nose-Hoover chain is applied to each type of motion.
When TGNH is used, the temperatures of molecular, atomic and Drude motion can be printed out with <a class="reference internal" href="thermo_style.html"><span class="doc">thermo_style command</span></a> command.</p>
<p>NVT simulation with TGNH thermostat</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">comm_modify</span><span class="w"> </span><span class="n">vel</span><span class="w"> </span><span class="n">yes</span>
<span class="k">fix </span><span class="nv nv-Identifier">TGNVT</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">tgnvt</span><span class="o">/</span><span class="n">drude</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="m">300</span><span class="n">.</span><span class="w"> </span><span class="m">300</span><span class="n">.</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">20</span>
<span class="k">thermo_style</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="n">f_TGNVT[1]</span><span class="w"> </span><span class="n">f_TGNVT[2]</span><span class="w"> </span><span class="n">f_TGNVT[3]</span>
</pre></div>
</div>
<p>NPT simulation with TGNH thermostat</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">comm_modify</span><span class="w"> </span><span class="n">vel</span><span class="w"> </span><span class="n">yes</span>
<span class="k">fix </span><span class="nv nv-Identifier">TGNPT</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">tgnpt</span><span class="o">/</span><span class="n">drude</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="m">300</span><span class="n">.</span><span class="w"> </span><span class="m">300</span><span class="n">.</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="n">iso</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">500</span>
<span class="k">thermo_style</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="n">f_TGNPT[1]</span><span class="w"> </span><span class="n">f_TGNPT[2]</span><span class="w"> </span><span class="n">f_TGNPT[3]</span>
</pre></div>
</div>
<hr class="docutils" />
<p><strong>Rigid bodies</strong></p>
<p>You may want to simulate molecules as rigid bodies (but polarizable).
Common cases are water models such as <a class="reference internal" href="#swm4-ndp"><span class="std std-ref">SWM4-NDP</span></a>, which is a
kind of polarizable TIP4P water.  The rigid bodies and the DPs should
be integrated separately, even with the Langevin thermostat.  Let us
review the different thermostats and ensemble combinations.</p>
<p>NVT ensemble using Langevin thermostat:</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">comm_modify</span><span class="w"> </span><span class="n">vel</span><span class="w"> </span><span class="n">yes</span>
<span class="k">fix </span><span class="nv nv-Identifier">LANG</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">langevin</span><span class="o">/</span><span class="n">drude</span><span class="w"> </span><span class="m">300</span><span class="n">.</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">12435</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">13977</span>
<span class="k">fix </span><span class="nv nv-Identifier">RIGID</span><span class="w"> </span><span class="nv nv-Identifier">ATOMS</span><span class="w"> </span><span class="n">rigid</span><span class="o">/</span><span class="n">nve</span><span class="o">/</span><span class="n">small</span><span class="w"> </span><span class="n">molecule</span>
<span class="k">fix </span><span class="nv nv-Identifier">NVE</span><span class="w"> </span><span class="nv nv-Identifier">DRUDES</span><span class="w"> </span><span class="n">nve</span>
</pre></div>
</div>
<p>NVT ensemble using Nose-Hoover thermostat:</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">fix </span><span class="nv nv-Identifier">DIRECT</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">drude</span><span class="o">/</span><span class="n">transform</span><span class="o">/</span><span class="n">direct</span>
<span class="k">fix </span><span class="nv nv-Identifier">RIGID</span><span class="w"> </span><span class="nv nv-Identifier">ATOMS</span><span class="w"> </span><span class="n">rigid</span><span class="o">/</span><span class="n">nvt</span><span class="o">/</span><span class="n">small</span><span class="w"> </span><span class="n">molecule</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="m">300</span><span class="n">.</span><span class="w"> </span><span class="m">300</span><span class="n">.</span><span class="w"> </span><span class="m">100</span>
<span class="k">fix </span><span class="nv nv-Identifier">NVT</span><span class="w"> </span><span class="nv nv-Identifier">DRUDES</span><span class="w"> </span><span class="n">nvt</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">20</span>
<span class="k">fix </span><span class="nv nv-Identifier">INVERSE</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">drude</span><span class="o">/</span><span class="n">transform</span><span class="o">/</span><span class="n">inverse</span>
</pre></div>
</div>
<p>NPT ensemble with Langevin thermostat:</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">comm_modify</span><span class="w"> </span><span class="n">vel</span><span class="w"> </span><span class="n">yes</span>
<span class="k">fix </span><span class="nv nv-Identifier">LANG</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">langevin</span><span class="o">/</span><span class="n">drude</span><span class="w"> </span><span class="m">300</span><span class="n">.</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">12435</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">13977</span>
<span class="k">fix </span><span class="nv nv-Identifier">RIGID</span><span class="w"> </span><span class="nv nv-Identifier">ATOMS</span><span class="w"> </span><span class="n">rigid</span><span class="o">/</span><span class="n">nph</span><span class="o">/</span><span class="n">small</span><span class="w"> </span><span class="n">molecule</span><span class="w"> </span><span class="n">iso</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">500</span>
<span class="k">fix </span><span class="nv nv-Identifier">NVE</span><span class="w"> </span><span class="nv nv-Identifier">DRUDES</span><span class="w"> </span><span class="n">nve</span>
</pre></div>
</div>
<p>NPT ensemble using Nose-Hoover thermostat:</p>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">compute </span><span class="nv nv-Identifier">TATOM</span><span class="w"> </span><span class="nv nv-Identifier">ATOMS</span><span class="w"> </span><span class="n">temp</span>
<span class="k">fix </span><span class="nv nv-Identifier">DIRECT</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">drude</span><span class="o">/</span><span class="n">transform</span><span class="o">/</span><span class="n">direct</span>
<span class="k">fix </span><span class="nv nv-Identifier">RIGID</span><span class="w"> </span><span class="nv nv-Identifier">ATOMS</span><span class="w"> </span><span class="n">rigid</span><span class="o">/</span><span class="n">npt</span><span class="o">/</span><span class="n">small</span><span class="w"> </span><span class="n">molecule</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="m">300</span><span class="n">.</span><span class="w"> </span><span class="m">300</span><span class="n">.</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="n">iso</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">500</span>
<span class="k">fix_modify</span><span class="w"> </span><span class="n">RIGID</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="n">TATOM</span><span class="w"> </span><span class="n">press</span><span class="w"> </span><span class="n">thermo_press</span>
<span class="k">fix </span><span class="nv nv-Identifier">NVT</span><span class="w"> </span><span class="nv nv-Identifier">DRUDES</span><span class="w"> </span><span class="n">nvt</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">1</span><span class="n">.</span><span class="w"> </span><span class="m">20</span>
<span class="k">fix </span><span class="nv nv-Identifier">INVERSE</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">drude</span><span class="o">/</span><span class="n">transform</span><span class="o">/</span><span class="n">inverse</span>
</pre></div>
</div>
<hr class="docutils" />
<p id="lamoureux2"><strong>(Lamoureux and Roux)</strong> Lamoureux and Roux, J Chem Phys, 119, 3025-3039 (2003)</p>
<p id="schroeder"><strong>(Schroeder)</strong>  Schroeder and Steinhauser, J Chem Phys, 133,
154511 (2010).</p>
<p id="thole2"><strong>(Thole)</strong> Chem Phys, 59, 341 (1981).</p>
<p id="noskov2"><strong>(Noskov)</strong> Noskov, Lamoureux and Roux, J Phys Chem B, 109, 6705 (2005).</p>
<p id="swm4-ndp"><strong>(SWM4-NDP)</strong> Lamoureux, Harder, Vorobyov, Roux, MacKerell, Chem Phys
Let, 418, 245-249 (2006)</p>
<p id="tgnh-son"><strong>(Son)</strong> Son, McDaniel, Cui and Yethiraj, J Phys Chem Lett, 10, 7523 (2019).</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Howto_drude.html" class="btn btn-neutral float-left" title="8.5.6. Drude induced dipoles" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Howto_peri.html" class="btn btn-neutral float-right" title="8.5.8. Peridynamics with LAMMPS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2003-2023 Sandia Corporation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>

        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>